# TTKölcsönző – Django+HTMX MVP (HU UI)

```
tkkolcsonzo/
├─ manage.py
├─ requirements.txt
├─ .gitignore
├─ tkkolcsonzo/
│  ├─ __init__.py
│  ├─ settings.py
│  ├─ urls.py
│  ├─ wsgi.py
│  └─ asgi.py
├─ core/
│  ├─ __init__.py
│  ├─ admin.py
│  ├─ apps.py
│  ├─ forms.py
│  ├─ models.py
│  ├─ urls.py
│  ├─ views.py
│  └─ migrations/
│     └─ __init__.py
├─ templates/
│  ├─ base.html
│  ├─ _messages.html
│  ├─ registration/
│  │  ├─ login.html
│  │  ├─ logged_out.html
│  │  └─ register.html
│  ├─ items/
│  │  ├─ list.html
│  │  ├─ detail.html
│  │  ├─ form.html
│  │  ├─ my_items.html
│  │  └─ confirm_delete.html
│  └─ loans/
│     ├─ my_loans.html
│     └─ partials/
│        └─ loan_card.html
└─ media/  (runtime)
```

---

## requirements.txt
```txt
Django==5.1.2
Pillow==11.0.0
```

---

## .gitignore
```gitignore
__pycache__/
*.py[cod]
*.sqlite3
/static/
/media/
.env
.DS_Store
Thumbs.db
```

---

## manage.py
```python
#!/usr/bin/env python
import os
import sys

def main():
    os.environ.setdefault("DJANGO_SETTINGS_MODULE", "tkkolcsonzo.settings")
    from django.core.management import execute_from_command_line
    execute_from_command_line(sys.argv)

if __name__ == "__main__":
    main()
```

---

## tkkolcsonzo/__init__.py
```python
# empty
```

---

## tkkolcsonzo/asgi.py
```python
import os
from django.core.asgi import get_asgi_application

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "tkkolcsonzo.settings")
application = get_asgi_application()
```

---

## tkkolcsonzo/wsgi.py
```python
import os
from django.core.wsgi import get_wsgi_application

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "tkkolcsonzo.settings")
application = get_wsgi_application()
```

---

## tkkolcsonzo/settings.py
```python
from pathlib import Path
import os

BASE_DIR = Path(__file__).resolve().parent.parent

SECRET_KEY = os.environ.get("DJANGO_SECRET_KEY", "dev-insecure-key-change-me")
DEBUG = os.environ.get("DJANGO_DEBUG", "1") == "1"
ALLOWED_HOSTS = ["*"]

INSTALLED_APPS = [
    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
    "core",
]

MIDDLEWARE = [
    "django.middleware.security.SecurityMiddleware",
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "django.middleware.clickjacking.XFrameOptionsMiddleware",
]

ROOT_URLCONF = "tkkolcsonzo.urls"

TEMPLATES = [
    {
        "BACKEND": "django.template.backends.django.DjangoTemplates",
        "DIRS": [BASE_DIR / "templates"],
        "APP_DIRS": True,
        "OPTIONS": {
            "context_processors": [
                "django.template.context_processors.debug",
                "django.template.context_processors.request",
                "django.contrib.auth.context_processors.auth",
                "django.contrib.messages.context_processors.messages",
            ],
        },
    },
]

WSGI_APPLICATION = "tkkolcsonzo.wsgi.application"
ASGI_APPLICATION = "tkkolcsonzo.asgi.application"

DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.sqlite3",
        "NAME": BASE_DIR / "db.sqlite3",
    }
}

AUTH_PASSWORD_VALIDATORS = [
    {"NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator"},
    {"NAME": "django.contrib.auth.password_validation.MinimumLengthValidator"},
]

LANGUAGE_CODE = "hu"
TIME_ZONE = "Europe/Budapest"
USE_I18N = True
USE_TZ = True

STATIC_URL = "/static/"
STATIC_ROOT = BASE_DIR / "static"

MEDIA_URL = "/media/"
MEDIA_ROOT = BASE_DIR / "media"

LOGIN_REDIRECT_URL = "/"
LOGOUT_REDIRECT_URL = "/"

DEFAULT_AUTO_FIELD = "django.db.models.BigAutoField"
```

---

## tkkolcsonzo/urls.py
```python
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static
from django.contrib.auth import views as auth_views

urlpatterns = [
    path("admin/", admin.site.urls),
    path("accounts/login/", auth_views.LoginView.as_view(), name="login"),
    path("accounts/logout/", auth_views.LogoutView.as_view(), name="logout"),
    path("", include("core.urls")),
]

if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

---

## core/apps.py
```python
from django.apps import AppConfig

class CoreConfig(AppConfig):
    default_auto_field = "django.db.models.BigAutoField"
    name = "core"
```

---

## core/models.py
```python
from django.db import models
from django.contrib.auth import get_user_model

User = get_user_model()

class Item(models.Model):
    owner = models.ForeignKey(User, on_delete=models.CASCADE, related_name="items")
    title = models.CharField(max_length=200)
    description = models.TextField(blank=True)
    category = models.CharField(max_length=100, blank=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        verbose_name = "Holmi"
        verbose_name_plural = "Holmik"

    def __str__(self) -> str:
        return self.title

    @property
    def is_available(self) -> bool:
        return not self.loans.filter(state__in=[
            Loan.State.REQUESTED,
            Loan.State.ACCEPTED,
            Loan.State.HANDED_OVER,
        ]).exists()

class ItemImage(models.Model):
    item = models.ForeignKey(Item, on_delete=models.CASCADE, related_name="images")
    image = models.ImageField(upload_to="items/")
    is_cover = models.BooleanField(default=False)

    class Meta:
        verbose_name = "Holmi kép"
        verbose_name_plural = "Holmi képek"

    def __str__(self) -> str:
        return f"Image for {self.item_id}"

class Loan(models.Model):
    class State(models.TextChoices):
        REQUESTED = "REQUESTED", "Requested"
        ACCEPTED = "ACCEPTED", "Accepted"
        HANDED_OVER = "HANDED_OVER", "Handed over"
        RETURNED = "RETURNED", "Returned"
        DECLINED = "DECLINED", "Declined"
        CANCELLED = "CANCELLED", "Cancelled"

    item = models.ForeignKey(Item, on_delete=models.CASCADE, related_name="loans")
    borrower = models.ForeignKey(User, on_delete=models.CASCADE, related_name="loans")
    state = models.CharField(max_length=20, choices=State.choices, default=State.REQUESTED)

    requested_at = models.DateTimeField(auto_now_add=True)
    accepted_at = models.DateTimeField(null=True, blank=True)
    handed_over_at = models.DateTimeField(null=True, blank=True)
    returned_at = models.DateTimeField(null=True, blank=True)
    cancelled_at = models.DateTimeField(null=True, blank=True)

    expected_return_date = models.DateField(null=True, blank=True)

    def __str__(self) -> str:
        return f"Loan({self.item.title} -> {self.borrower.username}) [{self.state}]"

    def can_accept(self, user) -> bool:
        return user == self.item.owner and self.state == self.State.REQUESTED

    def can_decline(self, user) -> bool:
        return user == self.item.owner and self.state == self.State.REQUESTED

    def can_cancel(self, user) -> bool:
        return user == self.borrower and self.state in [self.State.REQUESTED, self.State.ACCEPTED]

    def can_hand_over(self, user) -> bool:
        return user == self.item.owner and self.state == self.State.ACCEPTED

    def can_mark_returned(self, user) -> bool:
        return user == self.item.owner and self.state == self.State.HANDED_OVER
```

---

## core/admin.py
```python
from django.contrib import admin
from .models import Item, ItemImage, Loan

class ItemImageInline(admin.TabularInline):
    model = ItemImage
    extra = 0

@admin.register(Item)
class ItemAdmin(admin.ModelAdmin):
    list_display = ("id", "title", "owner", "category")
    search_fields = ("title", "description", "category")
    inlines = [ItemImageInline]

@admin.register(Loan)
class LoanAdmin(admin.ModelAdmin):
    list_display = ("id", "item", "borrower", "state", "requested_at")
    list_filter = ("state",)
    search_fields = ("item__title", "borrower__username")
```

---

## core/forms.py
```python
from django import forms
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth.models import User
from .models import Item, ItemImage

class ItemForm(forms.ModelForm):
    class Meta:
        model = Item
        fields = ["title", "description", "category"]

class ItemImageForm(forms.ModelForm):
    class Meta:
        model = ItemImage
        fields = ["image", "is_cover"]

class RegisterForm(UserCreationForm):
    class Meta:
        model = User
        fields = ["username", "password1", "password2"]
```

---

## core/urls.py
```python
from django.urls import path
from . import views

app_name = "core"

urlpatterns = [
    path("", views.item_list, name="item_list"),
    path("items/new/", views.item_create, name="item_create"),
    path("items/<int:pk>/", views.item_detail, name="item_detail"),
    path("items/<int:pk>/edit/", views.item_update, name="item_update"),
    path("items/<int:pk>/delete/", views.item_delete, name="item_delete"),
    path("items/<int:pk>/images/", views.item_add_image, name="item_add_image"),

    path("me/items/", views.my_items, name="my_items"),

    path("loans/", views.my_loans, name="my_loans"),
    path("loans/request/<int:item_id>/", views.loan_request, name="loan_request"),
    path("loans/<int:loan_id>/accept/", views.loan_accept, name="loan_accept"),
    path("loans/<int:loan_id>/decline/", views.loan_decline, name="loan_decline"),
    path("loans/<int:loan_id>/cancel/", views.loan_cancel, name="loan_cancel"),
    path("loans/<int:loan_id>/hand-over/", views.loan_hand_over, name="loan_hand_over"),
    path("loans/<int:loan_id>/return/", views.loan_mark_returned, name="loan_mark_returned"),

    path("register/", views.register, name="register"),
]
```

---

## core/views.py
```python
from django.contrib import messages
from django.contrib.auth.decorators import login_required
from django.contrib.auth import login
from django.shortcuts import get_object_or_404, redirect, render
from django.utils import timezone
from django.db.models import Q

from .models import Item, ItemImage, Loan
from .forms import ItemForm, ItemImageForm, RegisterForm

# Items

def item_list(request):
    q = request.GET.get("q", "").strip()
    category = request.GET.get("category", "").strip()

    items_qs = Item.objects.all().order_by("-created_at")
    if q:
        items_qs = items_qs.filter(Q(title__icontains=q) | Q(description__icontains=q))
    if category:
        items_qs = items_qs.filter(category__iexact=category)

    items = [i for i in items_qs if i.is_available]
    return render(request, "items/list.html", {"items": items, "q": q, "category": category})

@login_required
def my_items(request):
    items = Item.objects.filter(owner=request.user).order_by("-created_at")
    return render(request, "items/my_items.html", {"items": items})

@login_required
def item_create(request):
    if request.method == "POST":
        form = ItemForm(request.POST)
        if form.is_valid():
            item = form.save(commit=False)
            item.owner = request.user
            item.save()
            messages.success(request, "Holmi létrehozva.")
            return redirect("core:item_detail", pk=item.pk)
    else:
        form = ItemForm()
    return render(request, "items/form.html", {"form": form})

@login_required
def item_update(request, pk: int):
    item = get_object_or_404(Item, pk=pk)
    if item.owner != request.user:
        messages.error(request, "Csak a tulajdonos szerkesztheti ezt a holmit.")
        return redirect("core:item_detail", pk=pk)
    if request.method == "POST":
        form = ItemForm(request.POST, instance=item)
        if form.is_valid():
            form.save()
            messages.success(request, "Holmi frissítve.")
            return redirect("core:item_detail", pk=item.pk)
    else:
        form = ItemForm(instance=item)
    return render(request, "items/form.html", {"form": form, "title": "Holmi szerkesztése"})

@login_required
def item_delete(request, pk: int):
    item = get_object_or_404(Item, pk=pk)
    if item.owner != request.user:
        messages.error(request, "Csak a tulajdonos törölheti ezt a holmit.")
        return redirect("core:item_detail", pk=pk)
    if request.method == "POST":
        item.delete()
        messages.success(request, "Holmi törölve.")
        return redirect("core:my_items")
    return render(request, "items/confirm_delete.html", {"item": item})


def item_detail(request, pk: int):
    item = get_object_or_404(Item, pk=pk)
    active_loan = item.loans.filter(state__in=[
        Loan.State.REQUESTED, Loan.State.ACCEPTED, Loan.State.HANDED_OVER
    ]).first()
    return render(request, "items/detail.html", {
        "item": item,
        "active_loan": active_loan,
    })

@login_required
def item_add_image(request, pk: int):
    item = get_object_or_404(Item, pk=pk)
    if item.owner != request.user:
        messages.error(request, "Csak a tulajdonos adhat hozzá képet.")
        return redirect("core:item_detail", pk=pk)

    if request.method == "POST":
        form = ItemImageForm(request.POST, request.FILES)
        if form.is_valid():
            img = form.save(commit=False)
            img.item = item
            if img.is_cover:
                item.images.update(is_cover=False)
            img.save()
            messages.success(request, "Kép feltöltve.")
            return redirect("core:item_detail", pk=pk)
    else:
        form = ItemImageForm()
    return render(request, "items/form.html", {"form": form, "title": "Kép hozzáadása"})

# Loans

@login_required
def my_loans(request):
    loans_as_borrower = Loan.objects.filter(borrower=request.user).order_by("-requested_at")
    loans_as_owner = Loan.objects.filter(item__owner=request.user).order_by("-requested_at")
    return render(request, "loans/my_loans.html", {
        "loans_as_borrower": loans_as_borrower,
        "loans_as_owner": loans_as_owner,
    })

@login_required
def loan_request(request, item_id: int):
    item = get_object_or_404(Item, pk=item_id)
    if item.owner == request.user:
        messages.error(request, "Saját holmit nem kérhetsz kölcsön.")
        return redirect("core:item_detail", pk=item.pk)
    if not item.is_available:
        messages.error(request, "A holmi nem elérhető.")
        return redirect("core:item_detail", pk=item.pk)
    Loan.objects.create(item=item, borrower=request.user)
    messages.success(request, "Kölcsönkérés elküldve.")
    return redirect("core:my_loans")

@login_required
def loan_accept(request, loan_id: int):
    loan = get_object_or_404(Loan, pk=loan_id)
    if not loan.can_accept(request.user):
        messages.error(request, "Nincs jogosultság.")
        return redirect("core:my_loans")
    loan.state = Loan.State.ACCEPTED
    loan.accepted_at = timezone.now()
    loan.save()
    messages.success(request, "Kölcsönkérés elfogadva.")
    return redirect("core:my_loans")

@login_required
def loan_decline(request, loan_id: int):
    loan = get_object_or_404(Loan, pk=loan_id)
    if not loan.can_decline(request.user):
        messages.error(request, "Nincs jogosultság.")
        return redirect("core:my_loans")
    loan.state = Loan.State.DECLINED
    loan.save()
    messages.success(request, "Kölcsönkérés elutasítva.")
    return redirect("core:my_loans")

@login_required
def loan_cancel(request, loan_id: int):
    loan = get_object_or_404(Loan, pk=loan_id)
    if not loan.can_cancel(request.user):
        messages.error(request, "Nincs jogosultság.")
        return redirect("core:my_loans")
    loan.state = Loan.State.CANCELLED
    loan.cancelled_at = timezone.now()
    loan.save()
    messages.success(request, "Kölcsönkérés lemondva.")
    return redirect("core:my_loans")

@login_required
def loan_hand_over(request, loan_id: int):
    loan = get_object_or_404(Loan, pk=loan_id)
    if not loan.can_hand_over(request.user):
        messages.error(request, "Nincs jogosultság.")
        return redirect("core:my_loans")
    loan.state = Loan.State.HANDED_OVER
    loan.handed_over_at = timezone.now()
    loan.save()
    messages.success(request, "Átadás rögzítve.")
    return redirect("core:my_loans")

@login_required
def loan_mark_returned(request, loan_id: int):
    loan = get_object_or_404(Loan, pk=loan_id)
    if not loan.can_mark_returned(request.user):
        messages.error(request, "Nincs jogosultság.")
        return redirect("core:my_loans")
    loan.state = Loan.State.RETURNED
    loan.returned_at = timezone.now()
    loan.save()
    messages.success(request, "Visszahozatal rögzítve.")
    return redirect("core:my_loans")

# Registration

def register(request):
    if request.method == "POST":
        form = RegisterForm(request.POST)
        if form.is_valid():
            user = form.save()
            login(request, user)
            messages.success(request, "Sikeres regisztráció!")
            return redirect("core:item_list")
    else:
        form = RegisterForm()
    return render(request, "registration/register.html", {"form": form})
```

---

## templates/base.html
```html
<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TTKölcsönző</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="bg-white shadow">
    <div class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center">
      <a href="/" class="font-bold text-xl">TTKölcsönző</a>
      <nav class="space-x-4">
        {% if user.is_authenticated %}
          <a href="{% url 'core:item_create' %}" class="text-sm">Új holmi</a>
          <a href="{% url 'core:my_items' %}" class="text-sm">Saját holmik</a>
          <a href="{% url 'core:my_loans' %}" class="text-sm">Kölcsönzéseim</a>
          <form method="post" action="{% url 'logout' %}" class="inline">
            {% csrf_token %}
            <button class="text-sm">Kijelentkezés</button>
          </form>
        {% else %}
          <a href="{% url 'login' %}" class="text-sm">Bejelentkezés</a>
        {% endif %}
      </nav>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-6">
    {% include '_messages.html' %}
    {% block content %}{% endblock %}
  </main>
</body>
</html>
```

---

## templates/_messages.html
```html
{% if messages %}
  <div class="space-y-2 mb-4">
    {% for message in messages %}
      <div class="p-3 rounded bg-blue-100 text-blue-900">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}
```

---

## templates/registration/login.html
```html
{% extends 'base.html' %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Bejelentkezés</h1>
<form method="post" class="space-y-4 max-w-sm">
  {% csrf_token %}
  {% if form.errors %}
    <div class="p-3 rounded bg-red-100 text-red-800">Hibás felhasználónév vagy jelszó.</div>
  {% endif %}
  <div>
    <label class="block text-sm mb-1">Felhasználónév</label>
    <input type="text" name="username" required autofocus class="border rounded px-3 py-2 w-full" />
  </div>
  <div>
    <label class="block text-sm mb-1">Jelszó</label>
    <input type="password" name="password" required class="border rounded px-3 py-2 w-full" />
  </div>
  {% if next %}<input type="hidden" name="next" value="{{ next }}" />{% endif %}
  <button class="px-4 py-2 bg-black text-white rounded">Belépés</button>
</form>
<p class="mt-4 text-sm">Még nincs fiókod? <a href="{% url 'core:register' %}" class="underline">Regisztrálj itt</a></p>
{% endblock %}
```

---

## templates/registration/logged_out.html
```html
{% extends 'base.html' %}
{% block content %}
<p class="mb-4">Kijelentkeztél.</p>
<a href="/" class="px-4 py-2 bg-black text-white rounded">Vissza a főoldalra</a>
{% endblock %}
```

---

## templates/registration/register.html
```html
{% extends 'base.html' %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Regisztráció</h1>
<form method="post" class="space-y-4 max-w-sm">
  {% csrf_token %}
  {{ form.as_p }}
  <button class="px-4 py-2 bg-black text-white rounded">Regisztráció</button>
</form>
{% endblock %}
```

---

## templates/items/list.html
```html
{% extends 'base.html' %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Holmik böngészése</h1>
<form method="get" class="flex gap-2 mb-4">
  <input type="text" name="q" value="{{ q }}" placeholder="Keresés címre/leírásra"
         class="border rounded px-3 py-2 w-full" />
  <input type="text" name="category" value="{{ category }}" placeholder="Kategória"
         class="border rounded px-3 py-2" />
  <button class="px-4 py-2 bg-black text-white rounded">Szűrés</button>
</form>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
  {% for item in items %}
  <a href="{% url 'core:item_detail' item.pk %}" class="block bg-white rounded shadow hover:shadow-md">
    {% if item.images.first %}
      <img src="{{ item.images.first.image.url }}" alt="{{ item.title }}" class="w-full h-48 object-cover rounded-t" />
    {% else %}
      <div class="w-full h-48 bg-gray-200 rounded-t"></div>
    {% endif %}
    <div class="p-3">
      <div class="font-medium">{{ item.title }}</div>
      <div class="text-sm text-gray-500">{{ item.category }}</div>
    </div>
  </a>
  {% empty %}
  <p>Nincs elérhető holmi.</p>
  {% endfor %}
</div>
{% endblock %}
```

---

## templates/items/detail.html
```html
{% extends 'base.html' %}
{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  <div>
    {% if item.images.first %}
      <img src="{{ item.images.first.image.url }}" class="w-full rounded" />
    {% else %}
      <div class="w-full h-64 bg-gray-200 rounded"></div>
    {% endif %}
    <div class="mt-2 grid grid-cols-6 gap-2">
      {% for img in item.images.all %}
        <img src="{{ img.image.url }}" class="h-20 w-full object-cover rounded" />
      {% endfor %}
    </div>
  </div>
  <div>
    <h1 class="text-2xl font-semibold mb-2">{{ item.title }}</h1>
    <div class="text-gray-600 mb-2">Kategória: {{ item.category }}</div>
    <p class="mb-4 whitespace-pre-line">{{ item.description }}</p>

    {% if user == item.owner %}
      <div class="flex gap-2 mb-3">
        <a href="{% url 'core:item_update' item.pk %}" class="px-3 py-2 bg-gray-900 text-white rounded">Szerkesztés</a>
        <a href="{% url 'core:item_add_image' item.pk %}" class="px-3 py-2 bg-gray-700 text-white rounded">Kép hozzáadása</a>
        <a href="{% url 'core:item_delete' item.pk %}" class="px-3 py-2 bg-red-700 text-white rounded">Törlés</a>
      </div>
    {% else %}
      {% if item.is_available %}
        <a href="{% url 'core:loan_request' item.pk %}"
           class="px-3 py-2 bg-black text-white rounded">Kölcsön kérem</a>
      {% else %}
        <div class="text-sm text-red-600 font-medium">Jelenleg nem elérhető</div>
      {% endif %}
    {% endif %}

    {% if active_loan %}
      <div class="mt-4 text-sm">Aktív kölcsön állapota: <span class="font-medium">{{ active_loan.state }}</span></div>
    {% endif %}
  </div>
</div>
{% endblock %}
```

---

## templates/items/form.html
```html
{% extends 'base.html' %}
{% block content %}
<h1 class="text-xl font-semibold mb-4">{{ title|default:'Új holmi' }}</h1>
<form method="post" enctype="multipart/form-data" class="space-y-4">
  {% csrf_token %}
  {{ form.as_p }}
  <button class="px-4 py-2 bg-black text-white rounded">Mentés</button>
</form>
{% endblock %}
```

---

## templates/items/my_items.html
```html
{% extends 'base.html' %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Saját holmik</h1>
<a href="{% url 'core:item_create' %}" class="inline-block mb-4 px-3 py-2 bg-black text-white rounded">Új holmi</a>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
  {% for item in items %}
  <div class="bg-white rounded shadow">
    {% if item.images.first %}
      <img src="{{ item.images.first.image.url }}" class="w-full h-40 object-cover rounded-t" />
    {% else %}
      <div class="w-full h-40 bg-gray-200 rounded-t"></div>
    {% endif %}
    <div class="p-3">
      <div class="font-medium">{{ item.title }}</div>
      <div class="text-sm text-gray-500 mb-2">{{ item.category }}</div>
      <div class="flex gap-2">
        <a href="{% url 'core:item_detail' item.pk %}" class="text-sm underline">Megnyitás</a>
        <a href="{% url 'core:item_update' item.pk %}" class="text-sm underline">Szerkesztés</a>
        <a href="{% url 'core:item_delete' item.pk %}" class="text-sm underline text-red-700">Törlés</a>
      </div>
    </div>
  </div>
  {% empty %}
    <p>Még nincs egyetlen holmid sem.</p>
  {% endfor %}
</div>
{% endblock %}
```

---

## templates/items/confirm_delete.html
```html
{% extends 'base.html' %}
{% block content %}
<h1 class="text-xl font-semibold mb-4">Holmi törlése</h1>
<p class="mb-4">Biztosan törlöd ezt a holmit: <strong>{{ item.title }}</strong>?</p>
<form method="post">
  {% csrf_token %}
  <button class="px-4 py-2 bg-red-700 text-white rounded">Igen, törlöm</button>
  <a href="{% url 'core:item_detail' item.pk %}" class="ml-2 px-4 py-2 bg-gray-200 rounded">Mégse</a>
</form>
{% endblock %}
```

---

## templates/loans/partials/loan_card.html
```html
<div class="p-4 bg-white rounded shadow">
  <div class="font-medium mb-1">{{ loan.item.title }}</div>
  <div class="text-sm text-gray-600 mb-2">Állapot: {{ loan.state }}</div>
  <div class="flex gap-2 flex-wrap">
    {% if user == loan.item.owner %}
      {% if loan.state == 'REQUESTED' %}
        <a href="{% url 'core:loan_accept' loan.id %}" class="px-3 py-1 bg-green-700 text-white rounded">Elfogadás</a>
        <a href="{% url 'core:loan_decline' loan.id %}" class="px-3 py-1 bg-red-700 text-white rounded">Elutasítás</a>
      {% elif loan.state == 'ACCEPTED' %}
        <a href="{% url 'core:loan_hand_over' loan.id %}" class="px-3 py-1 bg-blue-700 text-white rounded">Átadás megtörtént</a>
      {% elif loan.state == 'HANDED_OVER' %}
        <a href="{% url 'core:loan_mark_returned' loan.id %}" class="px-3 py-1 bg-gray-900 text-white rounded">Visszahozva</a>
      {% endif %}
    {% endif %}

    {% if user == loan.borrower %}
      {% if loan.state in ('REQUESTED','ACCEPTED') %}
        <a href="{% url 'core:loan_cancel' loan.id %}" class="px-3 py-1 bg-orange-700 text-white rounded">Lemondás</a>
      {% endif %}
    {% endif %}
  </div>
</div>
```

---

## templates/loans/my_loans.html
```html
{% extends 'base.html' %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Kölcsönzéseim</h1>

<h2 class="text-lg font-semibold mb-2">Mint kölcsönkérő</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-6">
  {% for loan in loans_as_borrower %}
    {% include 'loans/partials/loan_card.html' with loan=loan %}
  {% empty %}
    <p>Nincs kölcsönzés.</p>
  {% endfor %}
</div>

<h2 class="text-lg font-semibold mb-2">Mint tulajdonos</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
  {% for loan in loans_as_owner %}
    {% include 'loans/partials/loan_card.html' with loan=loan %}
  {% empty %}
    <p>Nincs kölcsönzés.</p>
  {% endfor %}
</div>
{% endblock %}
```
